let listProducts = [
    {
        name: "DOLLIE PIGMENT DYED TEE",
        price: 59,
        img: "./image/tee/tee1.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee1.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee1-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee1-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "STOCK BOX TEE",
        price: 49,
        img: "./image/tee/tee2.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee2.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee2-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee2-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "TRIBE STACK TEE",
        price: 49,
        img: "./image/tee/tee3.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee3.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee3-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee3-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "SARA TEE",
        price: 59,
        img: "./image/tee/tee4.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee4.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee4-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee4-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "DOMINOES TEE",
        price: 49,
        img: "./image/tee/tee6.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee6.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee6-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee6-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "RACECAR TEE",
        price: 59,
        img: "./image/tee/tee7.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee7.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee7-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee7-3.webp",
                stock: 11
            }
        ]

    },
    {
        name: "ZIZZA TEE",
        price: 59,
        img: "./image/tee/tee8.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee8.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee8-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee8-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "ONTHE TEE",
        price: 49,
        img: "./image/tee/tee9.webp",
        nameList: "TEE",
        options: [
            {
                icon: "./image/tee/tee9.webp",
                stock: 5
            },
            {

                icon: "./image/tee/tee9-2.webp",
                stock: 9
            },
            {
                icon: "./image/tee/tee9-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "SARA ZIP HOODIE",
        price: 99,
        img: "./image/sweats/sw1.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw1.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw1-2.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw1-3.webp",
                stock: 11
            }
        ]
    },
    {
        name: "ZIP COLOR HOODIE",
        price: 109,
        img: "./image/sweats/sw5.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw5.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw5-2.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw5-3.webp",
                stock: 11
            }
        ]
    },
    {

        name: "SKULL CREST ZIP HOODIE",
        price: 99,
        img: "./image/sweats/sw2.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw2.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw2-2.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw5-3.webp",
                stock: 11
            }
        ]
    },
    {

        name: "OUR DYED HOODIE",
        price: 89,
        img: "./image/sweats/sw3.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw3.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw3.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw3-2.webp",
                stock: 11
            }
        ]
    },
    {

        name: "OVERDYED STOCK LOGO HOODIE",
        price: 99,
        img: "./image/sweats/sw4.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw4.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw4-2.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw4-3.webp",
                stock: 11
            }
        ]
    },
    {

        name: "NEWCOOL STOCK LOGO HOODIE",
        price: 99,
        img: "./image/sweats/sw6.webp",
        nameList: "SWT",
        options: [
            {
                icon: "./image/sweats/sw6.webp",
                stock: 5
            },
            {

                icon: "./image/sweats/sw6-2.webp",
                stock: 9
            },
            {
                icon: "./image/sweats/sw6-3.webp",
                stock: 11
            }
        ]
    },
    {

        name: "BOXY STRIPED SS SHIRT",
        price: 89,
        img: "./image/top&shirts/ts1.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/ts1.webp",
                stock: 5
            },
            {

                icon: "./image/top&shirts/ts1-2.webp",
                stock: 9
            },

        ]
    },
    {

        name: "TOP SHIRTS BLACK",
        price: 89,
        img: "./image/top&shirts/ts2.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/ts2.webp",
                stock: 5
            }
        ]
    },
    {
        name: "WRINKLY GINGHAM SS SHIRT",
        price: 99,
        img: "./image/top&shirts/st3.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/st3.webp",
                stock: 5
            },
            {

                icon: "./image/top&shirts/st3-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "4X4 MESH FOOTBALL JERSEY",
        price: 109,
        img: "./image/top&shirts/ts4.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/ts4.webp",
                stock: 5
            },
            {

                icon: "./image/top&shirts/ts4-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "OUR LEGACY WORK SHOP BORROWED SHIRT",
        price: 109,
        img: "./image/top&shirts/ts5.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/ts5.webp",
                stock: 5
            },
            {

                icon: "./image/top&shirts/ts5-2.webp",
                stock: 9
            },
            {

                icon: "./image/top&shirts/ts5-3.webp",
                stock: 9
            }
        ]
    },
    {
        name: "OUR LEGACY WORK SHOP RANCH SHIRT",
        price: 109,
        img: "./image/top&shirts/ts6.webp",
        nameList: "TS",
        options: [
            {
                icon: "./image/top&shirts/ts5.webp",
                stock: 5
            }
        ]
    },
    {
        name: "RIPSTOP CARGO BEACH PANTM",
        price: 199,
        img: "./image/bottom/bt6.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt6.webp",
                stock: 5
            },
            {

                icon: "./image/bottom/bt6-2.webp",
                stock: 9
            },
            {

                icon: "./image/bottom/bt6-3.webp",
                stock: 9
            }
        ]
    },
    {

        name: "DOLLIE PIGMENT DYED BOTTOM",
        price: 199,
        img: "./image/bottom/bt2.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt2.webp",
                stock: 5
            },
            {

                icon: "./image/bottom/bt2-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "OUR LEGACY WORK SHOP REDUCED TROUSER",
        price: 199,
        img: "./image/bottom/bt3.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt3.webp",
                stock: 5
            },
            {

                icon: "./image/bottom/bt3-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "DOLLIE BOTTOM",
        price: 89,
        img: "./image/bottom/bt4.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt4.webp",
                stock: 5
            }

        ]

    },
    {
        name: "DOLLIE PIG BOTTOM",
        price: 99,
        img: "./image/bottom/bt5.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt5.webp",
                stock: 5
            }
        ]

    },
    {
        name: "OUR LEGACY WORK SHOP WATER SHORT",
        price: 99,
        img: "./image/bottom/bt1.webp",
        nameList: "BT",
        options: [
            {
                icon: "./image/bottom/bt1.webp",
                stock: 5
            },
            {

                icon: "./image/bottom/bt1-2.webp",
                stock: 9
            },
            {

                icon: "./image/bottom/bt1-3.webp",
                stock: 9
            }
        ]
    },

    {
        name: "DOLLIE MENT OUTERWEAR",
        price: 299,
        img: "./image/outwear/ow1.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow1.webp",
                stock: 5
            },
            {

                icon: "./image/outwear/ow1-2.webp",
                stock: 9
            }

        ]

    },
    {
        name: "DOLLIE PIGT OUTERWEAR",
        price: 299,
        img: "./image/outwear/ow2.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow2.webp",
                stock: 5
            },
            {
                icon: "./image/outwear/ow2-2.webp",
                stock: 9
            }

        ]
    },
    {
        name: "DOLLIE PIGMENT OUTERWEAR",
        price: 299,
        img: "./image/outwear/ow3.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow3.webp",
                stock: 5
            },
            {
                icon: "./image/outwear/ow3-2.webp",
                stock: 9
            },
            {
                icon: "./image/outwear/ow3-3.webp",
                stock: 9
            }
        ]
    },
    {
        name: "DOLLIE PIGMENT OUTERWEAR",
        price: 249,
        img: "./image/outwear/ow4.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow4.webp",
                stock: 5
            },
            {
                icon: "./image/outwear/ow4-2.webp",
                stock: 9
            },
            {
                icon: "./image/outwear/ow4-3.webp",
                stock: 9
            }
        ]
    },
    {
        name: "OVERDYED ZIP WORK JACKET",
        price: 249,
        img: "./image/outwear/ow5-3.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow5.webp",
                stock: 5
            },
            {
                icon: "./image/outwear/ow5-2.webp",
                stock: 9
            },
            {
                icon: "./image/outwear/ow5-3.webp",
                stock: 9
            }
        ]

    },
    {
        name: "DOLLIE PIGMENT OUTERWEAR",
        price: 299,
        img: "./image/outwear/ow6.webp",
        nameList: "OT",
        options: [
            {
                icon: "./image/outwear/ow6.webp",
                stock: 5
            },
            {
                icon: "./image/outwear/ot6-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "STÜSSY & NIKE BENASSI SLIDE",
        price: 45,
        img: "./image/acces/ac1.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac1.webp",
                stock: 5
            },
            {
                icon: "./image/acces/ac1-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "LEATHER OVERLAY BELT",
        price: 45,
        img: "./image/acces/ac2.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac2.webp",
                stock: 5
            },
            {
                icon: "./image/acces/ac2-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "PEACE TIE CLIP",
        price: 45,
        img: "./image/acces/ac3.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac3.webp",
                stock: 5
            },
            {
                icon: "./image/acces/ac3-2.webp",
                stock: 9
            },
            {
                icon: "./image/acces/ac3-3.webp",
                stock: 9
            }
        ]

    },
    {
        name: "WORK GLOVES",
        price: 45,
        img: "./image/acces/ac4.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac4.webp",
                stock: 5
            },
            {
                icon: "./image/acces/ac4-2.webp",
                stock: 9
            },
            {
                icon: "./image/acces/ac4-3.webp",
                stock: 9
            }
        ]
    },
    {
        name: "WORK GLOVES",
        price: 45,
        img: "./image/acces/ac5.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac5.webp",
                stock: 5
            },
            {
                icon: "./image/acces/ac5-2.webp",
                stock: 9
            }
        ]
    },
    {
        name: "WORK GLOVES COLORMIX",
        price: 45,
        img: "./image/acces/ac6.webp",
        nameList: "AC",
        options: [
            {
                icon: "./image/acces/ac6.webp",
                stock: 5,
            },
            {
                icon: "./image/acces/ac6-2.webp",
                stock: 9
            }
        ]
    }
]
// hàm sinh id
function uuid() {
    return new Date().getMilliseconds() + Math.floor(Math.random() * 9999)
}

const USDollar = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
})

// gắn id cho product và các options
for (let i in listProducts) {
    listProducts[i].id = uuid();
    for (let j in listProducts[i].options) {
        listProducts[i].options[j].id = uuid() + j;
    }
}

// nếu như chưa có danh sách hàng hóa trong local thì thêm vào
if (!localStorage.getItem('listProducts')) {
    localStorage.setItem("listProducts", JSON.stringify(listProducts))
}
//function snackbar
function myFunction(param) {
    var x = document.getElementById("snackbar");
    x.className = "show";
    x.innerHTML = param;
    setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
}

//function banner ảnh tự lướt
let listBanner = document.querySelectorAll(".banner img")

let indexBanner = 0;
function nextBanner() {
    listBanner[indexBanner].style.display = "none";
    indexBanner = (indexBanner + 1) % listBanner.length
    listBanner[indexBanner].style.display = "block";
}
setInterval(nextBanner, 1000)
let currentPage = 1;
let toTalItemPage = 6; // Số ảnh hiện thị trong 1 trang
let start;
let end;
function showCurrentPage(page) {
    start = (page - 1) * toTalItemPage;
    end = page * toTalItemPage
}

showCurrentPage(currentPage)
// function kiểm tra người đăng nhập có phải là admin hay không. 
// nếu là admin thì hiển thị nút admin để truy cập vào kho hàng


function showListPage(a) {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    let result = "";
    for (let i = 0; i < Math.ceil(listProducts.length / toTalItemPage); i++) {
        result +=
            `
            <li onclick="pageNow(${i})" class="itemPage">${i + 1}</li>
        `
    }
    document.getElementById("listShowPage").innerHTML = result;
    document.getElementsByClassName("itemPage")[a].classList.add("active-page")
    showArrowCurrent(currentPage)
}

//function chuyển qua trang tiếp theo 
function increasePage() {
    currentPage++;
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))

    if (currentPage == Math.ceil(listProducts.length / toTalItemPage) + 1) {
        currentPage = Math.ceil(listProducts.length / toTalItemPage)
    }
    let listItemPage = document.getElementsByClassName("itemPage")
  
    for (let i = 0; i < listItemPage.length; i++) {

        if (i == currentPage - 1) {

            listItemPage[i].classList.add("active-page");

        } else {

            listItemPage[i].classList.remove("active-page");
        }

    }
    showCurrentPage(currentPage);
    renderProducts(JSON.parse(localStorage.getItem("listProducts")));
    showListPage(currentPage - 1)
}


function decreasePage() {
    console.log("decrease");
    let listItemPage = document.getElementsByClassName("itemPage");
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    currentPage--;
    if (currentPage == 0) {
        currentPage = 1
    }
    for (let i = 0; i < listItemPage.length; i++) {
        if (i == currentPage - 1) {
            listItemPage[i].classList.add("active-page");
        } else {
            listItemPage[i].classList.remove("active-page");
        }

    }
    showCurrentPage(currentPage);
    renderProducts(JSON.parse(localStorage.getItem("listProducts")));
    showListPage(currentPage - 1)
}
//function click vào page now thì khi click tiếp chuyển trang tới
function pageNow(pageNow) {
    console.log(currentPage);
    console.log(pageNow);
    let listItemPage = document.getElementsByClassName("itemPage")
    for (let i = 0; i < listItemPage.length; i++) {
        if (i == pageNow) {
            listItemPage[i].classList.add("active-page");
        } else {
            listItemPage[i].classList.remove("active-page");
        }

    }
    showCurrentPage(pageNow + 1);

    renderProducts(JSON.parse(localStorage.getItem("listProducts")));
    showListPage(pageNow)
    currentPage = pageNow + 1;
}

function showArrowCurrent(a) {
    console.log(a);
    if (a < 2) {
        document.querySelector(".material-symbols-outlined").style.display = "none"
        return;
    } else if (a > 1 && a != 7) {
        document.querySelector(".material-symbols-outlined").style.display = "block"
        return;
    } else if (a == 7) {
        document.querySelector(".symbolsRight").style.display = "none"
    }
}


function renderProducts(param) {
    let result = ""
    for (let i = 0; i < param.length; i++) {
        if (i >= start && i < end) {
            result +=
                `
        <div class="item" > 
            <div class="item-img">
                 <img src="${param[i].img}" alt="" onclick="renderProductItem('${param[i].id}')">
            </div>
            <div class="item-detail">
                 <p class = "item-name">Name: ${param[i].name} </p>
                <p class = "item-detail-price" >Price : ${USDollar.format(param[i].price)}</p>
             </div>

        </div>
          `
        }
    }
    document.querySelector(".product").innerHTML =
        `
   <div class="main">  ${result} </div>
   
        <div class="list-page">
            <span onclick="decreasePage()" class="material-symbols-outlined">
                navigate_before
            </span>
            <ul id="listShowPage">
            
            </ul>
            <span onclick="increasePage()" class="material-symbols-outlined symbolsRight">
                chevron_right
            </span>
        </div>

    `
        ;
    showListPage(0)
}

function loginNext() {
    window.location.href = "../html/login.html";

}


function registerNext() {
    window.location.href = "../html/register.html";
}

function addCart(idProduct) {
    //idOption cua tung san pham
    let idOptions = document.querySelector('#selectOptions').innerText;
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let product = listProducts.find((product) => {
        return product.id == idProduct;
    })
    let name = product.name;
    console.log(name);
    let options = product.options;
    let option = options.find((option) => {
        return option.id == idOptions;
    })
    let src = option.icon;
    
    // kiem tra logion
    let checkIsLogin = localStorage.getItem("checkLogin");
    if (checkIsLogin == null) {
        myFunction("Not logged in - can't add product to cart.")
        return;
    }

    let listUser = JSON.parse(localStorage.getItem("listUser"));
    //khi đã có được list user thì mình dựa vào iduser
    // lấy ra giỏ hàng của user
    let stockOfProduct = Number(document.getElementById("stockOption").innerHTML);
    for (let i = 0; i < listUser.length; i++) {
        // lấy ra người dùng
        if (listUser[i].idUser == checkIsLogin) {
            console.log("gio hang", listUser[i].cartUser.length)
            if (listUser[i].cartUser.length == 0) {
                // Giỏ hàng khi chưa có gì
                let countQuantity = Number(document.getElementById("countQuantity").innerHTML);
                if (countQuantity == 0) {
                    myFunction("Please check the quantity of product!")
                    break;
                } else {
                    if (countQuantity <= stockOfProduct) {      
                        listUser[i].cartUser.push({
                            name : name,
                            src: src,
                            productId: idProduct,
                            idOption: idOptions,
                            quantity: countQuantity
                        })
                        document.getElementById("countQuantity").innerHTML = 0;
                    } else {
                        myFunction("Not enough products left in stock!")
                    }
                }
            } else {
                //Khi giỏ hàng đã có sản phẩm
                let flag = false;
                for (let j in listUser[i].cartUser) {
                    if (listUser[i].cartUser[j].productId == idProduct && listUser[i].cartUser[j].idOption == idOptions) {
                        let countQuantity = document.getElementById("countQuantity").innerHTML;
                        if (countQuantity == 0) {
                            myFunction("Please check the quantity of product!");
                            break;
                        } else {
                            if (countQuantity <= stockOfProduct) {
                                listUser[i].cartUser[j].quantity = Number(listUser[i].cartUser[j].quantity) + Number(countQuantity);
                                document.getElementById("countQuantity").innerHTML = 0;
                                flag = true;
                                break;
                            } else {
                                myFunction("Not enough products left in stock!");
                                break;
                            }

                        }
                    }
                }
                if (!flag) {
                    let countQuantity = Number(document.getElementById("countQuantity").innerHTML);
                    if (countQuantity == 0) {
                        myFunction("Please check the quantity of product!");
                        break;
                    } else {

                        if (countQuantity <= stockOfProduct) {
                            listUser[i].cartUser.push({
                                name : name,
                                src: src,
                                productId: idProduct,
                                idOption: idOptions,
                                quantity: countQuantity,
                            })
                            flag = false;
                            document.getElementById("countQuantity").innerHTML = 0;
                        } else {
                            myFunction("Not enough products left in stock!");
                        }

                    }

                }
            }
            localStorage.setItem('listUser', JSON.stringify(listUser)); // save to local
            showTotalCartProduct();
            break;
        }
    }

}



function showTotalCartProduct() {

    let listUser = JSON.parse(localStorage.getItem("listUser"));
    if (!listUser) {
        return 0
    }
    let checkIsLogin = localStorage.getItem("checkLogin");

    let user = listUser.find((item) => {
        return item.idUser == checkIsLogin
    })

    let cartUser = (user.cartUser);

    let total = cartUser.reduce((total1, curreValue) => {
        return total1 += curreValue.quantity;
    }, 0)

    
    document.getElementById("totalCoutnProduct").innerHTML = `${total}`;
}

if (checkLogin()) {
    showTotalCartProduct()
}


function renderTee() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("TEE")) {
            listRender.push(listProducts[i])
        }
    }
   
    start = 0;
    end = 6;
    renderProducts(listRender)
    showListPage(listRender.length)

}


function renderSW() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("SW")) {
            listRender.push(listProducts[i])
        }

    }
    
    start = 0;
    end = 6;
    renderProducts(listRender)
}

function renderTS() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("TS")) {
            listRender.push(listProducts[i])
        }

    }
    start = 0;
    end = 6;
    renderProducts(listRender)
}

function renderBT() {
    
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("BT")) {
            listRender.push(listProducts[i])
        }

    }
    start = 0;
    end = 6;
    renderProducts(listRender)
}

function renderOT() {
 
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("OT")) {
            listRender.push(listProducts[i])
        }

    }
    start = 0;
    end = 6;
    renderProducts(listRender)
}

function renderAC() {
  
    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let listRender = [];
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].nameList.includes("AC")) {
            listRender.push(listProducts[i])
        }

    }
    start = 0;
    end = 6;
    renderProducts(listRender)
}

function checklogout() {
    let confirmLogout = confirm("You want to exit?")
    if (confirmLogout) {
        localStorage.removeItem("checkLogin");
        document.getElementsByClassName("logout")[0].style.display = "none";
        document.getElementById("totalCoutnProduct").innerHTML = 0;
        document.getElementsByClassName("login")[0].style.display = "block";
        document.getElementsByClassName("register")[0].style.display = "block";

    }
}

function checkLogin() {
    let getLogin = localStorage.getItem("checkLogin");
    if (getLogin == null) {

        document.getElementsByClassName("logout")[0].style.display = "none";
        document.getElementsByClassName("login")[0].style.display = "block";
        document.getElementsByClassName("register")[0].style.display = "block";
        return false;
    } else {
        document.getElementsByClassName("login")[0].style.display = "none";
        document.getElementsByClassName("register")[0].style.display = "none";
        return true;
    }
};

// function kiểm tra xem người đăng nhập có phải là admin hay không .
function checkAdmin() {
    let checkAdmin = localStorage.getItem("checkLogin")
    let flag = true;
    
    // 724 là mã id của admin. fix cứng 1 tài khoản riêng cho admin
    if (checkAdmin == 724) {
       
        document.querySelector(".admin-button").style.display = "block";

    } else {
       
        document.querySelector(".admin-button").style.display = "none";
        return;

    }
}
checkAdmin()
function admin() {
    window.location.href = "../html/admin.html"
}

if (checkLogin()) {
    document.getElementsByClassName("logout")[0].style.display = "block";
};



function soldOut(stock) {
    if (stock <= 0) {
        return 'hidden';
    }
}

function renderProductItem(idProduct) {
    let listProductLocal = JSON.parse(localStorage.getItem("listProducts"));
    let productItem = listProductLocal.find((item) => {
        return item.id == idProduct
    })

    let result = `
    <div class="productContainer">
        <div class="item-left">
            <img id="main-image" src="${productItem.img}" alt="">
            <span class="soldOut ${soldOut(productItem.options[0].stock)}">SOLD OUT</span> 
        </div>
        <div class="item-right">
            <div class="item-right-detail">
                <h2>${productItem.name}</h2>
                <span>Price : ${USDollar.format(productItem.price)}</span>
            <div class="color">
                <span>Select Color:</span> <br>
                
            </div>
        <p class="select-quantity">
           
            <span onclick=decreaseQuantity() class="drc">-</span>
            <span id="countQuantity"> 0 </span> 
            <span onclick=increaseQuantity() class="drc">+</span> 
        </p>
        <span class="shipping">Free shipping in US for orders over $200 USD</span> <br>
        <span>Stock Available : <span id="stockOption">${productItem.options[0].stock}</span> items</span>
        <p id="selectOptions">${productItem.options[0].id}</p>
       
        <p><i onclick=addCart('${productItem.id}') class="fa-solid fa-cart-shopping minicart"></i></p>
    </div>
    </div>
 </div>
    `
    document.querySelector(".product").innerHTML = result;

    let color = document.querySelector(".color");
    let resultColor = "";
    for (let j in productItem.options) {
        resultColor += `
        <img onclick="renderSelectColor('${productItem.options[j].icon}', '${productItem.options[j].id}', '${productItem.options[j].stock}')" src="${productItem.options[j].icon}" alt="">
        `
    }
    color.innerHTML = `<span> Select Color:</span> <br> ${resultColor}`;
};
// function tăng sản phẩm khi thêm vào giỏ hàng 
function increaseQuantity() {
    let count = document.getElementById("countQuantity").innerHTML;
    count++;
    document.getElementById("countQuantity").innerHTML = count;

}
// function giảm sản phẩm khi thêm vào giỏ hàng 
function decreaseQuantity() {
    let count = document.getElementById("countQuantity").innerHTML;
    count--;
    if (count == -1) {
        count = 0;
    }
    document.getElementById("countQuantity").innerHTML = count;

}
function searchProduct() {

    document.querySelector(".search-products").style.display = "grid";
    
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    console.log(listProducts);
    let valueSearch = document.getElementById("valueSearch").value;
    let userSearch = listProducts.filter(item => {
        return item.name.toUpperCase().includes(valueSearch.toUpperCase())
    })

    renderSearchProducts(userSearch);

};

// Hàm hiển thị sản phẩm người dùng muốn tìm kiếm

function renderSearchProducts(params) {
    let result = "";
    for (let i = 0; i < params.length; i++) {
        result += `
        <div class="search-product-item" onclick="renderProductItem('${params[i].id}')">
            <div class="search-product-item-img">
                <img src="${params[i].img}" alt="">
            </div>
            <div class="search-product-item-info">
                <h5>${params[i].name}</h5>
                <p>${USDollar.format(params[i].price)}</p>
            </div>
        </div>
        `
    }
    document.querySelector(".search-products").innerHTML = result;
    document.querySelector(".product").style.opacity = 0.5;
}

// Hàm xử lí khi người dùng xóa hết dữ liệu trong ô tìm kiếm thì ẩn vùng hiển thị sản phẩm đã tìm kiếm
document.querySelector(".search-product").addEventListener("input", handleInputclear);


function handleInputclear() {
    let valueSearch = document.getElementById("valueSearch").value;

    if (valueSearch === "") {
        document.querySelector(".search-products").innerHTML = "";
        document.querySelector(".search-products").style.display = "none";
        document.querySelector(".product").style.opacity = 1;
    }
}

// Hàm xử lí khi click vào vùng khác thì ẩn vùng hiển thị sản phẩm đã tìm kiếm

document.addEventListener("click", handleClickOutside);

function handleClickOutside(event) {
    let searchProduct = document.querySelector(".search-products");
    let target = event.target;

    if (!searchProduct.contains(target)) {
        document.querySelector(".search-products").innerHTML = "";
        // document.querySelector(".search-products").classList.add("show");
        document.querySelector(".product").style.opacity = 1;
    }
}

//function de nguoi dung chon mau 

function renderSelectColor(param, optionId, optionStock) {
    document.querySelector("#main-image").src = `${param}`;
    document.querySelector('#selectOptions').innerText = optionId;
    document.querySelector('#stockOption').innerText = optionStock;

    const soldOutElement = document.querySelector(".soldOut");
    if (optionStock <= 0) {
        soldOutElement.classList.add("hidden");
    }else {
        soldOutElement.classList.remove("hidden"); 
    }
}


document.querySelector("#cart-product").addEventListener("click", () => {
    window.location.href = "../html/cart.html"
})

// bar js
window.onload = function () {
    const bar = document.getElementById("bar");
    const nav = document.querySelector(".nav-bottom ");
    const login = document.querySelector(".div-login");
    if (bar) {
        bar.addEventListener("click", () => {
            nav.classList.toggle("active")
            login.classList.toggle("active");
        })
    }
}
